<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>11 Lab 12 - Using Python to automate QGIS | ENMPG11 Geomatics - Module Workbook</title>
  <meta name="description" content="Workbook for the ENMPG11 Geomatics Graduate Module at University of Stirling." />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="11 Lab 12 - Using Python to automate QGIS | ENMPG11 Geomatics - Module Workbook" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Workbook for the ENMPG11 Geomatics Graduate Module at University of Stirling." />
  <meta name="github-repo" content="thiagosfsilva/ENMPG11" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="11 Lab 12 - Using Python to automate QGIS | ENMPG11 Geomatics - Module Workbook" />
  
  <meta name="twitter:description" content="Workbook for the ENMPG11 Geomatics Graduate Module at University of Stirling." />
  

<meta name="author" content="Thiago Silva" />


<meta name="date" content="2020-03-26" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="lab11.html"/>
<link rel="next" href="assignment-final-project.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    background-color: #2a211c;
    color: #bdae9d;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #bdae9d;  padding-left: 4px; }
div.sourceCode
  { color: #bdae9d; background-color: #2a211c; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ffff00; } /* Alert */
code span.an { color: #0066ff; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #44aa43; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #43a8ed; font-weight: bold; } /* ControlFlow */
code span.ch { color: #049b0a; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #0066ff; font-weight: bold; font-style: italic; } /* Comment */
code span.do { color: #0066ff; font-style: italic; } /* Documentation */
code span.dt { text-decoration: underline; } /* DataType */
code span.dv { color: #44aa43; } /* DecVal */
code span.er { color: #ffff00; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #44aa43; } /* Float */
code span.fu { color: #ff9358; font-weight: bold; } /* Function */
code span.im { } /* Import */
code span.in { color: #0066ff; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #43a8ed; font-weight: bold; } /* Keyword */
code span.op { } /* Operator */
code span.pp { font-weight: bold; } /* Preprocessor */
code span.sc { color: #049b0a; } /* SpecialChar */
code span.ss { color: #049b0a; } /* SpecialString */
code span.st { color: #049b0a; } /* String */
code span.va { } /* Variable */
code span.vs { color: #049b0a; } /* VerbatimString */
code span.wa { color: #ffff00; font-weight: bold; } /* Warning */
</style>

<link rel="stylesheet" href="toc.css" type="text/css" />
<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">ENMPG11 Workbook</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome!</a></li>
<li class="chapter" data-level="1" data-path="outline.html"><a href="outline.html"><i class="fa fa-check"></i><b>1</b> Module Outline and General Info</a><ul>
<li class="chapter" data-level="1.1" data-path="outline.html"><a href="outline.html#staff-and-communication"><i class="fa fa-check"></i><b>1.1</b> Staff and Communication:</a></li>
<li class="chapter" data-level="1.2" data-path="outline.html"><a href="outline.html#about-the-module"><i class="fa fa-check"></i><b>1.2</b> About the Module</a></li>
<li class="chapter" data-level="1.3" data-path="outline.html"><a href="outline.html#intended-learning-outcomes-ilos"><i class="fa fa-check"></i><b>1.3</b> Intended Learning Outcomes (ILO’s):</a></li>
<li class="chapter" data-level="1.4" data-path="outline.html"><a href="outline.html#readings-and-resources"><i class="fa fa-check"></i><b>1.4</b> Readings and Resources</a></li>
<li class="chapter" data-level="1.5" data-path="outline.html"><a href="outline.html#attendance-and-points-of-contact"><i class="fa fa-check"></i><b>1.5</b> Attendance and Points of Contact</a></li>
<li class="chapter" data-level="1.6" data-path="outline.html"><a href="outline.html#class-schedule-and-structure"><i class="fa fa-check"></i><b>1.6</b> Class Schedule and Structure</a></li>
<li class="chapter" data-level="1.7" data-path="outline.html"><a href="outline.html#assessment-and-grading"><i class="fa fa-check"></i><b>1.7</b> Assessment and Grading</a><ul>
<li class="chapter" data-level="" data-path="outline.html"><a href="outline.html#hands-on-problems-50-of-final-grade"><i class="fa fa-check"></i>1) Hands-on problems (50% of final grade)</a></li>
<li class="chapter" data-level="" data-path="outline.html"><a href="outline.html#final-individual-project-50-of-the-final-grade"><i class="fa fa-check"></i>2) Final individual project (50% of the final grade)</a></li>
</ul></li>
<li class="chapter" data-level="1.8" data-path="outline.html"><a href="outline.html#module-timetable-and-dates"><i class="fa fa-check"></i><b>1.8</b> Module Timetable and Dates</a></li>
<li class="chapter" data-level="1.9" data-path="outline.html"><a href="outline.html#other-relevant-information"><i class="fa fa-check"></i><b>1.9</b> Other Relevant Information</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="lab1.html"><a href="lab1.html"><i class="fa fa-check"></i><b>2</b> Lab 1 - QGIS overview and file management</a><ul>
<li class="chapter" data-level="2.1" data-path="lab1.html"><a href="lab1.html#GE1"><i class="fa fa-check"></i><b>2.1</b> Guided Exercise 1 - A simple GIS workflow</a><ul>
<li class="chapter" data-level="2.1.1" data-path="lab1.html"><a href="lab1.html#creating-a-project-structure"><i class="fa fa-check"></i><b>2.1.1</b> Creating a project structure</a></li>
<li class="chapter" data-level="2.1.2" data-path="lab1.html"><a href="lab1.html#creating-a-qgis-project"><i class="fa fa-check"></i><b>2.1.2</b> Creating a QGIS project</a></li>
<li class="chapter" data-level="2.1.3" data-path="lab1.html"><a href="lab1.html#styling-your-layers-and-producing-a-simple-map"><i class="fa fa-check"></i><b>2.1.3</b> Styling your layers and producing a simple map</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="lab1.html"><a href="lab1.html#self-guided-exercise"><i class="fa fa-check"></i><b>2.2</b> Self-guided exercise</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="lab2.html"><a href="lab2.html"><i class="fa fa-check"></i><b>3</b> Lab 2 - Working with vector data - Attributes</a><ul>
<li class="chapter" data-level="3.1" data-path="lab2.html"><a href="lab2.html#guided-exercise-1---basic-work-with-vector-data"><i class="fa fa-check"></i><b>3.1</b> Guided Exercise 1 - Basic work with Vector Data</a></li>
<li class="chapter" data-level="3.2" data-path="lab2.html"><a href="lab2.html#guided-exercise-2-operations-using-layer-attributes"><i class="fa fa-check"></i><b>3.2</b> Guided Exercise 2: Operations using layer attributes</a></li>
<li class="chapter" data-level="3.3" data-path="lab2.html"><a href="lab2.html#guided-exercise-3---spatial-queries"><i class="fa fa-check"></i><b>3.3</b> Guided Exercise 3 - Spatial Queries</a></li>
<li class="chapter" data-level="3.4" data-path="lab2.html"><a href="lab2.html#self-guided-summative-assessment."><i class="fa fa-check"></i><b>3.4</b> Self-guided summative assessment.</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="lab3.html"><a href="lab3.html"><i class="fa fa-check"></i><b>4</b> Lab 3 - Working with vector data - Geoprocessing Tools</a><ul>
<li class="chapter" data-level="4.1" data-path="lab3.html"><a href="lab3.html#guided-exercise-1---clipping-data"><i class="fa fa-check"></i><b>4.1</b> Guided Exercise 1 - Clipping data</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="lab4.html"><a href="lab4.html"><i class="fa fa-check"></i><b>5</b> Lab 4 - Working with raster data - the basics</a><ul>
<li class="chapter" data-level="5.1" data-path="lab4.html"><a href="lab4.html#guided-exercise-1---opening-and-inspecting-raster-data"><i class="fa fa-check"></i><b>5.1</b> Guided Exercise 1 - Opening and inspecting raster data</a></li>
<li class="chapter" data-level="5.2" data-path="lab4.html"><a href="lab4.html#guided-exercise-2---styling-raster-data"><i class="fa fa-check"></i><b>5.2</b> Guided Exercise 2 - Styling raster data</a></li>
<li class="chapter" data-level="5.3" data-path="lab4.html"><a href="lab4.html#guided-exercise-3---mathematical-and-boolean-operations-using-the-raster-calculator"><i class="fa fa-check"></i><b>5.3</b> Guided Exercise 3 - Mathematical and boolean operations using the Raster Calculator</a></li>
<li class="chapter" data-level="5.4" data-path="lab4.html"><a href="lab4.html#guided-exercise-3---masking-and-reprojecting-raster-data."><i class="fa fa-check"></i><b>5.4</b> Guided Exercise 3 - Masking and reprojecting raster data.</a></li>
<li class="chapter" data-level="5.5" data-path="lab4.html"><a href="lab4.html#formative-assessment"><i class="fa fa-check"></i><b>5.5</b> Formative Assessment</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="lab5.html"><a href="lab5.html"><i class="fa fa-check"></i><b>6</b> Lab 5 - Working with raster data - continued</a><ul>
<li class="chapter" data-level="6.1" data-path="lab5.html"><a href="lab5.html#guided-exercise-1---converting-rasters-to-vectors"><i class="fa fa-check"></i><b>6.1</b> Guided Exercise 1 - Converting rasters to vectors</a></li>
<li class="chapter" data-level="6.2" data-path="lab5.html"><a href="lab5.html#guided-exercise-2---zonal-statistics-redux"><i class="fa fa-check"></i><b>6.2</b> Guided Exercise 2 - Zonal statistics redux</a></li>
<li class="chapter" data-level="6.3" data-path="lab5.html"><a href="lab5.html#guided-exercise-3---terrain-analysis"><i class="fa fa-check"></i><b>6.3</b> Guided exercise 3 - Terrain Analysis</a></li>
<li class="chapter" data-level="6.4" data-path="lab5.html"><a href="lab5.html#formative-assessment-1"><i class="fa fa-check"></i><b>6.4</b> Formative Assessment</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="lab6.html"><a href="lab6.html"><i class="fa fa-check"></i><b>7</b> Lab 6 - Interpolating data</a><ul>
<li class="chapter" data-level="7.1" data-path="lab6.html"><a href="lab6.html#guided-exercise-1---creating-distance-rasters"><i class="fa fa-check"></i><b>7.1</b> Guided Exercise 1 - Creating distance rasters</a></li>
<li class="chapter" data-level="7.2" data-path="lab6.html"><a href="lab6.html#guided-exercise-2---density-estimation"><i class="fa fa-check"></i><b>7.2</b> Guided exercise 2 - Density Estimation</a></li>
<li class="chapter" data-level="7.3" data-path="lab6.html"><a href="lab6.html#guided-exercise-3---interpolating-values"><i class="fa fa-check"></i><b>7.3</b> Guided exercise 3 - Interpolating values</a></li>
<li class="chapter" data-level="7.4" data-path="lab6.html"><a href="lab6.html#formative-assessment-2"><i class="fa fa-check"></i><b>7.4</b> Formative assessment</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="lab8.html"><a href="lab8.html"><i class="fa fa-check"></i><b>8</b> Lab 8 - Practicing GIS</a><ul>
<li class="chapter" data-level="8.1" data-path="lab8.html"><a href="lab8.html#organizing-your-database"><i class="fa fa-check"></i><b>8.1</b> Organizing your database</a></li>
<li class="chapter" data-level="8.2" data-path="lab8.html"><a href="lab8.html#applying-the-criteria"><i class="fa fa-check"></i><b>8.2</b> Applying the criteria</a></li>
<li class="chapter" data-level="8.3" data-path="lab8.html"><a href="lab8.html#reporting-the-results"><i class="fa fa-check"></i><b>8.3</b> Reporting the results</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="lab9.html"><a href="lab9.html"><i class="fa fa-check"></i><b>9</b> Lab 9 - Cartography and map making</a><ul>
<li class="chapter" data-level="9.1" data-path="lab9.html"><a href="lab9.html#testing-some-cartographic-principles"><i class="fa fa-check"></i><b>9.1</b> Testing some cartographic principles</a></li>
<li class="chapter" data-level="9.2" data-path="lab9.html"><a href="lab9.html#formative-assessment---revisiting-the-flood-mapping"><i class="fa fa-check"></i><b>9.2</b> Formative assessment - revisiting the flood mapping</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="lab11.html"><a href="lab11.html"><i class="fa fa-check"></i><b>10</b> Lab 11 - Satellite Image Manipulation and Classification</a><ul>
<li class="chapter" data-level="10.1" data-path="lab11.html"><a href="lab11.html#image-band-stacking-and-clipping"><i class="fa fa-check"></i><b>10.1</b> Image band stacking and clipping</a></li>
<li class="chapter" data-level="10.2" data-path="lab11.html"><a href="lab11.html#color-composition"><i class="fa fa-check"></i><b>10.2</b> Color composition</a></li>
<li class="chapter" data-level="10.3" data-path="lab11.html"><a href="lab11.html#manual-digitazion"><i class="fa fa-check"></i><b>10.3</b> Manual digitazion</a></li>
<li class="chapter" data-level="10.4" data-path="lab11.html"><a href="lab11.html#automatic-classification"><i class="fa fa-check"></i><b>10.4</b> Automatic classification</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="lab12.html"><a href="lab12.html"><i class="fa fa-check"></i><b>11</b> Lab 12 - Using Python to automate QGIS</a><ul>
<li class="chapter" data-level="11.1" data-path="lab12.html"><a href="lab12.html#the-python-console"><i class="fa fa-check"></i><b>11.1</b> The Python console</a></li>
<li class="chapter" data-level="11.2" data-path="lab12.html"><a href="lab12.html#opening-data"><i class="fa fa-check"></i><b>11.2</b> Opening data</a></li>
<li class="chapter" data-level="11.3" data-path="lab12.html"><a href="lab12.html#styling-layers"><i class="fa fa-check"></i><b>11.3</b> Styling layers</a></li>
<li class="chapter" data-level="11.4" data-path="lab12.html"><a href="lab12.html#accessing-and-manipulating-vector-attributes"><i class="fa fa-check"></i><b>11.4</b> Accessing and manipulating vector Attributes</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="assignment-final-project.html"><a href="assignment-final-project.html"><i class="fa fa-check"></i><b>12</b> Assignment - Final Project</a><ul>
<li class="chapter" data-level="12.1" data-path="assignment-final-project.html"><a href="assignment-final-project.html#project-thinking"><i class="fa fa-check"></i><b>12.1</b> Project Thinking</a></li>
<li class="chapter" data-level="12.2" data-path="assignment-final-project.html"><a href="assignment-final-project.html#project-rerquirements"><i class="fa fa-check"></i><b>12.2</b> Project Rerquirements:</a></li>
<li class="chapter" data-level="12.3" data-path="assignment-final-project.html"><a href="assignment-final-project.html#project-support-and-deadlines"><i class="fa fa-check"></i><b>12.3</b> Project support and deadlines</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown"target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">ENMPG11 Geomatics - Module Workbook</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="lab12" class="section level1">
<h1><span class="header-section-number">11</span> Lab 12 - Using Python to automate QGIS</h1>
<p>Python is one of the most popular programming languages in the world, due its versatility and ease of learning. It is also free and open source, meaning you will not lose access to it. Most GIS platforms havee converged for using Python as their automating language, including ArcGIS (ArcPy) and QGIS (PyQGIS). Also, several Geomatics toolboxes can be commanded through Python, such as <a href="https://www.orfeo-toolbox.org/">Orfeo Toolbox</a>], <a href="https://www.rsgislib.org/">RSGISlib</a> and <a href="https://jblindsay.github.io/ghrg/WhiteboxTools/index.html">White Box Tools</a>.</p>
<p>Although Python has packages to deal directly with Geeospatial data within Python itself (e.g. Shapely, Rasterio, Geopandas), here we will focus on using Python as a scripting language to use QGIS functions.</p>
<p>The main documentation for PyQGIS is at <a href="https://docs.qgis.org/3.4/en/docs/pyqgis_developer_cookbook/index.html" class="uri">https://docs.qgis.org/3.4/en/docs/pyqgis_developer_cookbook/index.html</a>.</p>
<div id="the-python-console" class="section level2">
<h2><span class="header-section-number">11.1</span> The Python console</h2>
<p>The easiest way to use PyQGIS is by using the Python Console built in QGIS. It already loads all PyQGIS libraries and dependencies when you launch it, so you don’t need to do it manually. You can access it from `Plugins &gt; Python Console….</p>
<ul>
<li><p>Once you open it, click on the small wrench icon to set the options below, on both the <code>Console</code> and <code>Editor</code> side tabs:</p>
<ul>
<li><p>Under <code>Autocompletion</code>, select <code>from docs and APIs</code></p></li>
<li><p>Under <code>Typing</code>, enable <code>Automatic parentheses insertion</code></p></li>
</ul></li>
</ul>
<p>Once you’re done, then click on the Notepad icon. This will open an editor window. This is usually the best wat to work, as you can then save all the commands you have typed as a script, and run them all at once every time it is needed.</p>
<p>More info about the console here: <a href="https://docs.qgis.org/3.4/en/docs/user_manual/plugins/python_console.html?highlight=console" class="uri">https://docs.qgis.org/3.4/en/docs/user_manual/plugins/python_console.html?highlight=console</a></p>
</div>
<div id="opening-data" class="section level2">
<h2><span class="header-section-number">11.2</span> Opening data</h2>
<p>Although you can read layers using PyQGIS without adding them to the project, it is easy to use the QGIS interface commands. These commands all come from the <code>iface</code> class, which gives access to elements of QGIS’ interface.</p>
<ul>
<li>Grab the ‘Folow along’ data from Lab 9.</li>
</ul>
<p>To open a vector layer, we use the following commands:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb1-1" title="1"><span class="co"># 1) Define the layer path. CHANGE TO REFLECT YOUR PATH!#</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="co">#    Also, notice the direction of the slashes!</span></a>
<a class="sourceLine" id="cb1-3" title="3">sssi_path <span class="op">=</span> <span class="st">&quot;C:/Projects/ENMPG11/data/LAB_9/follow_along/SSSI_data/SSSI_ns.shp&quot;</span></a>
<a class="sourceLine" id="cb1-4" title="4"></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="co"># 2) Use the ifce.addVectorLayer to add it to QGIS. </span></a>
<a class="sourceLine" id="cb1-6" title="6">sssi <span class="op">=</span> vlayer <span class="op">=</span> iface.addVectorLayer(sssi_path, <span class="st">&quot;SSSI&quot;</span>, <span class="st">&quot;ogr&quot;</span>)</a></code></pre></div>
<div class="rmdimportant">
<p>
<strong>IMPORTANT:</strong> as you add lines to your script, every time you run it it will re-do the previous actions. You can prevent that by “commenting out” the lines you don’t need to execute again, by adding a comment symbol(<code>#</code>) at the start of the line.
</p>
</div>
<p>The process is similar for a raster layer:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb2-1" title="1"><span class="co"># For rasters, we don&#39;t need to specify the &#39;ogr&#39; driver</span></a>
<a class="sourceLine" id="cb2-2" title="2">dtm_path <span class="op">=</span> <span class="st">&quot;C:/Projects/ENMPG11/data/LAB_9/follow_along/OS_dtm50/OS_dtm_50.tif&quot;</span></a>
<a class="sourceLine" id="cb2-3" title="3">dtm <span class="op">=</span> iface.addRasterLayer(dtm_path, <span class="st">&quot;OS DTM 50&quot;</span>)</a></code></pre></div>
<p>More details on adding layers on <a href="https://docs.qgis.org/3.4/en/docs/pyqgis_developer_cookbook/loadlayer.html" class="uri">https://docs.qgis.org/3.4/en/docs/pyqgis_developer_cookbook/loadlayer.html</a></p>
</div>
<div id="styling-layers" class="section level2">
<h2><span class="header-section-number">11.3</span> Styling layers</h2>
<p>We can also control layer symbology directly from the script, so the layer is pre-loaded with our wanted symbology. In PyQGIS terminology, this means specifying a “renderer”. For example, this is the default renderedr for our DTM layer:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb3-1" title="1"><span class="co"># For rasters, we don&#39;t need to specify the &#39;ogr&#39; driver</span></a>
<a class="sourceLine" id="cb3-2" title="2">dtm.renderer()</a></code></pre></div>
<p>As we can see, the default renderer is the <code>QgsSingleBandGrayRenderer</code>. It is also good to notice that the renderer is a property of the raster object, and thus can be acessed using the dot (<code>.</code>) notation. These are the programmatic names of the QGIS raster renderers:</p>
<ul>
<li><code>QgsMultiBandColorRenderer</code></li>
<li><code>QgsPalettedRasterRenderer</code></li>
<li><code>QgsSingleBandColorDataRenderer</code></li>
<li><code>QgsSingleBandGrayRenderer</code></li>
<li><code>QgsSingleBandPseudoColorRenderer</code></li>
</ul>
<p>Let us use the <code>QgsSingleBandPseudoColorRenderer</code> to set a color ramp for our DTM raster:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb4-1" title="1"><span class="co"># 1) First, we set an empty color ramp object. A object with coloring </span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="co"># instruction in PyQGIS is called a &#39;shader&#39;:</span></a>
<a class="sourceLine" id="cb4-3" title="3">color_ramp <span class="op">=</span> QgsColorRampShader()</a>
<a class="sourceLine" id="cb4-4" title="4"></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="co"># Then, we set how we will distribute the colors. Options are</span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="co"># &#39;Interpolated&#39;, &#39;Discrete&#39; and &#39; Exact&#39;.</span></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="co"># Notice the dot notation, so the type of ramp is a property of</span></a>
<a class="sourceLine" id="cb4-8" title="8"><span class="co"># the color ramp.</span></a>
<a class="sourceLine" id="cb4-9" title="9">color_ramp.setColorRampType(QgsColorRampShader.Interpolated)</a>
<a class="sourceLine" id="cb4-10" title="10"></a>
<a class="sourceLine" id="cb4-11" title="11"><span class="co"># Then we generate a list of initial and final color values</span></a>
<a class="sourceLine" id="cb4-12" title="12"><span class="co"># for the ramp. We need to use the proper PyQGIS objects here</span></a>
<a class="sourceLine" id="cb4-13" title="13"><span class="co"># (&#39;ColorRampItem&#39; and &#39;QColor&#39;). Color order is always (Red,Green,Blue)</span></a>
<a class="sourceLine" id="cb4-14" title="14"><span class="co"># so (0,255,0) is pure green, and (255,255,0) is yellow (red + green)  </span></a>
<a class="sourceLine" id="cb4-15" title="15">color_list <span class="op">=</span> [QgsColorRampShader.ColorRampItem(<span class="dv">0</span>, QColor(<span class="dv">0</span>,<span class="dv">255</span>,<span class="dv">0</span>)),</a>
<a class="sourceLine" id="cb4-16" title="16">      QgsColorRampShader.ColorRampItem(<span class="dv">255</span>, QColor(<span class="dv">255</span>,<span class="dv">255</span>,<span class="dv">0</span>)) ]</a>
<a class="sourceLine" id="cb4-17" title="17"></a>
<a class="sourceLine" id="cb4-18" title="18"><span class="co"># Now we set the property &#39;list of colors&#39; for the color ramp</span></a>
<a class="sourceLine" id="cb4-19" title="19">coor_ramp.setColorRampItemList(color_list)</a>
<a class="sourceLine" id="cb4-20" title="20"></a>
<a class="sourceLine" id="cb4-21" title="21"><span class="co"># Now we creat a new empty raster shader, and set it to our color ramp</span></a>
<a class="sourceLine" id="cb4-22" title="22">dtm_symb <span class="op">=</span> QgsRasterShader()</a>
<a class="sourceLine" id="cb4-23" title="23">dtm_symb.setRasterShaderFunction(color_ramp)</a>
<a class="sourceLine" id="cb4-24" title="24"></a>
<a class="sourceLine" id="cb4-25" title="25"><span class="co"># Finally, we attach this raster shader to our raster object,</span></a>
<a class="sourceLine" id="cb4-26" title="26"><span class="co"># and redraw it with the new colors</span></a>
<a class="sourceLine" id="cb4-27" title="27"></a>
<a class="sourceLine" id="cb4-28" title="28"><span class="co"># 1) create a renderer from the shader. &#39;1&#39;  refers to band 1.</span></a>
<a class="sourceLine" id="cb4-29" title="29">color_ramp_renderer <span class="op">=</span> QgsSingleBandPseudoColorRenderer(dtm.dataProvider(), <span class="dv">1</span>, dtm_symb)</a>
<a class="sourceLine" id="cb4-30" title="30"></a>
<a class="sourceLine" id="cb4-31" title="31"><span class="co"># 2) Set this new renderer as the renderer for our DTM layer and redraw</span></a>
<a class="sourceLine" id="cb4-32" title="32">dtm.setRenderer(color_ramp_renderer)</a>
<a class="sourceLine" id="cb4-33" title="33">dtm.triggerRepaint()</a></code></pre></div>
<p>Whew! It seems like lot of work versus doing it directly on QGIS, but remember than only you do this once, you will work forever, no matter how many times you run your script (and you can copy and paste it to other scripts).</p>
<p>Let us now do it for vectors. A vector layer appearance is given by the <em>renderer</em> and by <em>symbols</em> associated with the layer. <em>Symbols</em> take care of drawing the visual representation of features, while <em>renderers</em> determine what symbol will be used for a particular feature.</p>
<p>For our SSSI layer:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb5-1" title="1"><span class="co"># What is the current symbology?</span></a>
<a class="sourceLine" id="cb5-2" title="2">sssi.renderer()</a>
<a class="sourceLine" id="cb5-3" title="3">sssi.renderer().<span class="bu">type</span>()</a></code></pre></div>
<p>As with rasters, the QGIS symbology types for vectors have corresponding renderers:</p>
<ul>
<li><code>QgsSingleSymbolRenderer</code></li>
<li><code>QgsCategorizedSymbolRenderer</code></li>
<li><code>QgsGraduatedSymbolRenderer</code></li>
</ul>
<p>Let us change the outline and fill color of our SSSI raster:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb6-1" title="1"><span class="co"># First, let us see what symbol properties we can set.</span></a>
<a class="sourceLine" id="cb6-2" title="2"><span class="co"># This information is nested way down in the object, and we </span></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="co"># need to dig it out. The command below goes into the renderer for</span></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="co"># the SSSI layer, then grabs its symbol, then looks at the first set of symbols (symbol layer, usualy only one), and then gets the properties</span></a>
<a class="sourceLine" id="cb6-5" title="5"><span class="bu">print</span>(sssi.renderer().symbol().symbolLayer(<span class="dv">0</span>).properties())</a>
<a class="sourceLine" id="cb6-6" title="6"></a>
<a class="sourceLine" id="cb6-7" title="7"><span class="co"># If we want to change fill colour, fill outline colour and </span></a>
<a class="sourceLine" id="cb6-8" title="8"><span class="co">#outline width, we then:</span></a>
<a class="sourceLine" id="cb6-9" title="9"></a>
<a class="sourceLine" id="cb6-10" title="10"><span class="co"># 1) Make a copy of the properties dictionary</span></a>
<a class="sourceLine" id="cb6-11" title="11">new_properties <span class="op">=</span> sssi.renderer().symbol().symbolLayer(<span class="dv">0</span>).properties()</a>
<a class="sourceLine" id="cb6-12" title="12"></a>
<a class="sourceLine" id="cb6-13" title="13"><span class="co"># 2) Change the properties we want</span></a>
<a class="sourceLine" id="cb6-14" title="14">new_properties[<span class="st">&#39;color&#39;</span>] <span class="op">=</span> <span class="st">&#39;255,0,0,130&#39;</span> <span class="co"># the fourth number is transparency</span></a>
<a class="sourceLine" id="cb6-15" title="15">new_properties[<span class="st">&#39;outline_color&#39;</span>] <span class="op">=</span> <span class="st">&#39;0,0,255,255&#39;</span></a>
<a class="sourceLine" id="cb6-16" title="16">new_properties[<span class="st">&#39;outline_width&#39;</span>] <span class="op">=</span> <span class="st">&#39;0.5&#39;</span></a>
<a class="sourceLine" id="cb6-17" title="17"></a>
<a class="sourceLine" id="cb6-18" title="18"><span class="co"># 3) Replace the old properties dictionary with the new</span></a>
<a class="sourceLine" id="cb6-19" title="19">sssi.renderer().setSymbol(QgsFillSymbol.createSimple(new_properties))</a>
<a class="sourceLine" id="cb6-20" title="20"></a>
<a class="sourceLine" id="cb6-21" title="21"><span class="co"># 4) Redraw</span></a>
<a class="sourceLine" id="cb6-22" title="22">sssi.triggerRepaint()</a></code></pre></div>
<p>To be sure, go to <code>Properties &gt; Symbology</code> and see if it looks ok.</p>
<p>To dig deeper, check <a href="https://docs.qgis.org/3.4/en/docs/pyqgis_developer_cookbook/vector.html#appearance-symbology-of-vector-layers" class="uri">https://docs.qgis.org/3.4/en/docs/pyqgis_developer_cookbook/vector.html#appearance-symbology-of-vector-layers</a></p>
</div>
<div id="accessing-and-manipulating-vector-attributes" class="section level2">
<h2><span class="header-section-number">11.4</span> Accessing and manipulating vector Attributes</h2>
<p>We can also script our data analysis. For example, we can access and manipulate vector attributes:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb7-1" title="1"><span class="co"># If you are typing at the comand line, type on extra &#39;enter&#39; to finish</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="cf">for</span> field <span class="kw">in</span> sssi.fields():</a>
<a class="sourceLine" id="cb7-3" title="3">  <span class="bu">print</span>(field.name(), field.typeName())</a>
<a class="sourceLine" id="cb7-4" title="4">  </a>
<a class="sourceLine" id="cb7-5" title="5"><span class="co"># We can then select features programatically. You may want to open</span></a>
<a class="sourceLine" id="cb7-6" title="6"><span class="co"># the attribute table for the layer to see the effect. Make sure you select &quot;Show selected features&quot; on the bottom.</span></a>
<a class="sourceLine" id="cb7-7" title="7"></a>
<a class="sourceLine" id="cb7-8" title="8"><span class="co"># Select all:</span></a>
<a class="sourceLine" id="cb7-9" title="9">sssi.selectAll()</a>
<a class="sourceLine" id="cb7-10" title="10"></a>
<a class="sourceLine" id="cb7-11" title="11"><span class="co"># Clear selection</span></a>
<a class="sourceLine" id="cb7-12" title="12">sssi.removeSelection()</a>
<a class="sourceLine" id="cb7-13" title="13"></a>
<a class="sourceLine" id="cb7-14" title="14"><span class="co"># Select using an expression</span></a>
<a class="sourceLine" id="cb7-15" title="15">sssi.selectByExpression(<span class="st">&#39;&quot;)</span></a>
<a class="sourceLine" id="cb7-16" title="16"></a>
<a class="sourceLine" id="cb7-17" title="17"><span class="st"># Multiple criteria. Note that QGIS wants field names in double quotes</span></a>
<a class="sourceLine" id="cb7-18" title="18"><span class="st"># and strings(text) in single quotes, but the whole expression has to</span></a>
<a class="sourceLine" id="cb7-19" title="19"><span class="st"># be a string as well, so we need to escape (i.e. ignore) the single</span></a>
<a class="sourceLine" id="cb7-20" title="20"><span class="st"># quotes around the text &#39;</span>0BIOLOGICAL<span class="st">&#39; using a backslash.</span></a>
<a class="sourceLine" id="cb7-21" title="21"><span class="st">sssi.selectByExpression(&#39;&quot;SITE_HA&quot;</span> <span class="op">&gt;</span> <span class="dv">1000</span> <span class="kw">and</span> <span class="st">&quot;TYPE&quot;</span> <span class="op">=</span> <span class="op">\</span><span class="st">&#39;0BIOLOGICAL</span><span class="ch">\&#39;</span><span class="st">&#39;</span>)</a>
<a class="sourceLine" id="cb7-22" title="22"></a>
<a class="sourceLine" id="cb7-23" title="23"><span class="co"># Get attribute contents, store and print .</span></a>
<a class="sourceLine" id="cb7-24" title="24"><span class="co"># Each polygon is a feature, so we need to go over all of them.</span></a>
<a class="sourceLine" id="cb7-25" title="25"><span class="cf">for</span> feature <span class="kw">in</span> sssi.getFeatures():</a>
<a class="sourceLine" id="cb7-26" title="26">    names <span class="op">=</span> feature[<span class="st">&quot;NAME&quot;</span>]</a>
<a class="sourceLine" id="cb7-27" title="27">    <span class="bu">print</span>(names)</a>
<a class="sourceLine" id="cb7-28" title="28">    </a>
<a class="sourceLine" id="cb7-29" title="29">    </a>
<a class="sourceLine" id="cb7-30" title="30"><span class="co"># Create a new attribute:</span></a></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="lab11.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="assignment-final-project.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
